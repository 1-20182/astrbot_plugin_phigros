# 📝 更新日记

---

## v1.4.0 - API 版扫码登录来啦！🚀

> **"拜拜了 playwright，你好呀 API！"**

### ✨ 这次更新了啥？

#### 📱 全新的扫码登录
- 改用 **Phigros Query API** 实现扫码登录，超快的！
- 不用装浏览器了，轻量又省心~ 😎
- 支持国服 `cn` 和国际服 `global`
- 二维码还是 2 分钟有效期哦

#### 📦 依赖大变样
**说拜拜的：**
- 👋 `playwright` - 再也不需要浏览器自动化了
- 👋 `chromium` - 不用下载大大的浏览器了

**新来的：**
- 🆕 `qrcode` - 小巧的二维码生成库

**安装超简单：**
```bash
pip install qrcode>=7.4.2
```

### 🎯 性能飞升

| 项目 | 以前 | 现在 | 提升 |
|------|------|------|------|
| 启动速度 | 5-10 秒 | <1 秒 | **10倍！** 🚀 |
| 内存占用 | 高（浏览器吃内存） | 低 | **省超多！** 💾 |
| 稳定性 | 页面一变就挂 | 稳稳的 | **超可靠！** ✅ |
| 安装包大小 | ~100MB | <1MB | **100倍！** 📦 |

### 🔧 技术小秘密

#### 用到的 API 接口

| 接口 | 干啥的 |
|------|--------|
| `POST /auth/qrcode` | 生成二维码，拿到 `qrId` 和链接 |
| `GET /auth/qrcode/{qr_id}/status` | 轮询状态，扫码成功拿 `sessionToken` |
| `POST /save` | 获取你的游戏存档 |
| `POST /rks/history` | 查看 RKS 历史变化 |

#### 登录流程
```
1️⃣ 调用 API 生成二维码
   ↓
2️⃣ 用 qrcode 库生成 PNG 图片
   ↓
3️⃣ 你扫码并在手机上确认
   ↓
4️⃣ 轮询 API 检查状态
   ↓
5️⃣ 拿到 sessionToken 自动绑定！
```

### 📁 改了哪些文件？

**新增：**
- `taptap_login_api.py` - 全新的 API 登录模块 ✨

**修改：**
- `main.py` - 改用新的登录方式
- `requirements.txt` - 更新依赖清单
- `README.md` - 更新安装说明
- `taptap_login.py` - 静默处理（兼容保留）

### ⚠️ 注意啦！

1. **要重启 AstrBot** 才能用新功能哦！
2. **记得装新依赖：** `pip install qrcode>=7.4.2`
3. **建议配置 API Token** - 在插件设置里填 `phigros_api_token`，会更稳定

---

## 以前的版本

### v1.3.0 - Best30 成绩图来啦！🎨
- ✅ 新增 Best30 成绩图功能（`/phi_b30`）
- ✅ 自动生成最美的 30 首歌曲成绩图
- ✅ 支持排名显示（金银铜牌）

### v1.2.0 - 扫码登录来啦！📱
- ✅ 新增 TapTap 扫码登录功能（`/phi_qrlogin`）
- ✅ 自动获取 sessionToken，超方便！
- ✅ 二维码有效期 2 分钟

### v1.1.0 - 绑定功能来啦！🔗
- ✅ 新增账号绑定功能（`/phi_bind` / `/phi_unbind`）
- ✅ 绑定后 `/phi_save` 和 `/phi_rks_history` 免输 token
- ✅ 重构渲染器，图片更美观
- ✅ 添加资源文件（歌曲数据、字体、图标）
- ✅ 文字大小根据图片尺寸自动缩放

### v1.0.0 - 初次见面！👋
- ✅ 出生啦！基础功能全都有
- ✅ 能生成美美的图片
- ✅ 支持曲绘显示
- ✅ 支持 WebUI 配置

---

<div align="center">

### 🎵 打歌快乐，RKS 飞涨！🎵

*——来自空间站「塔弦」的 Phigros Query 插件*

</div>
